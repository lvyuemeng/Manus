<!-- Generated by GitHub Copilot assistant: concise, repo-specific guidance -->
# Copilot / AI Agent Guidance

Purpose
- Help AI agents quickly understand, modify, and build Typst templates and the included `zh-draft` toolkit.

Big picture
- This repository is a set of Typst templates and utilities for producing documents (theses, daily notes).
- Major parts:
  - `mine/` — entry templates and assembly logic (see `mine/mine.typ`, `mine/core.typ`, `mine/deps.typ`).
  - `mine/templates/` — canned document templates (daily-en, thesis-am-zh, thesis-cp-zh).
  - `zh-draft/` (git submodule) — reusable component library with `lib.typ`, `components.typ`, `utils.typ`.
  - `mine/bib/` — CSL styles used for bibliography rendering.

Key patterns & conventions
- Template selection: `mine()` in `mine/mine.typ` chooses a template via `select-template(name)`; add new templates to `mine/templates/` and register them there.
- Styling is applied via higher-order wrappers: `with-text-style`, `with-page-style`, `with-heading-style`, `with-math-style`, `with-figure-style` in `mine/core.typ`. Prefer adding features by composing these wrappers rather than editing global defaults.
- Config flow: a `config-store` state is used to pass resolved styles (see `core.typ` and `resolve-config`). Use `state("tmpl-config", (:))` to access runtime template settings.
- Component import pattern: submodule/library files are imported with relative paths, e.g. from `zh-draft` components use `#import "../zh-draft/lib.typ": *` or the submodule's `lib.typ` as an entrypoint.
- Naming: functions that return blocks are named `with-*` (style wrappers) or `*` (e.g., `mine`) — follow existing naming for consistency.

Build / render workflows
- Render any Typst source directly with the Typst CLI: `typst compile <file>.typ` (common targets: `mine/mine.typ` or examples in `zh-draft/example/`).
- The `zh-draft` submodule includes a `typst.toml` whose `entrypoint` is `lib.typ` — when editing the submodule locally, preserve that layout.
- When cloning the repo: run `git submodule update --init --recursive` to ensure `zh-draft` is available.

Code-editing guidelines for agents
- Minimize changes to `core.typ`; extend via `resolve-config` and `with-*` wrappers.
- Keep `#import "@preview/..."` package pins intact; these are external preview packages used by templates.
- When modifying templates, ensure `mine/mine.typ`'s `select-template` recognizes the new template name.
- For internationalization: the repo sets CJK fonts (e.g., `Microsoft YaHei`) — prefer cross-platform-safe fonts or document when Windows-specific fonts are used.

Files to inspect first (fast path)
- `mine/mine.typ` — entry wrapper and template selector
- `mine/core.typ` — styles, wrappers, numbering and figure handling
- `mine/deps.typ` — imports and external package pins
- `zh-draft/lib.typ`, `zh-draft/components.typ`, `zh-draft/utils.typ` — component library and helpers

Common pitfalls for agents
- Changing global counters or resets (e.g., appendix behavior) can break numbering across templates — prefer localized changes.
- Be careful with relative import paths when moving files; typst resolves imports relative to the file doing the `#import`.

What to ask the human before large changes
- Should changes be backwards-compatible with existing templates? (Most callers expect the same public `mine()` API.)
- Can we update fonts or external package versions? (These can affect rendering and CI.)

Next steps for reviewers
- If this looks good, update or approve; tell the agent whether to also run a sample `typst compile` for a chosen example.

(End of file)
